# 银图PMC智能分析平台 - 系统需求文档

## 1. 项目概述

### 1.1 项目背景
银图PMC智能分析平台是一个为吹风机制造工厂开发的生产计划与物料控制(PMC)决策支持系统。该系统通过整合多源数据，提供数据驱动的采购决策和投资回报率(ROI)分析。

### 1.2 业务目标
- **提升资金效率**：将投资回报率从2.0-2.5倍提升至2.8-3.0倍（提升20%）
- **降低缺料率**：减少30-40%的物料短缺
- **加速决策**：实现分钟级生产排单决策
- **快速响应**：5分钟内发现并响应生产异常

### 1.3 技术栈
- **后端**: Python 3.10+
- **数据处理**: Pandas, NumPy
- **Web框架**: Streamlit
- **可视化**: Plotly
- **文件处理**: OpenPyXL (Excel), CSV

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 数据整合分析
- **功能描述**: 整合订单、欠料、库存、供应商四类数据源
- **实现方式**: LEFT JOIN架构确保100%订单覆盖
- **输入**:
  - 订单文件: order-amt-89.xlsx, order-amt-89-c.xlsx
  - 欠料文件: mat_owe_pso.xlsx
  - 库存文件: inventory_list.xlsx
  - 供应商文件: supplier.xlsx
- **输出**: 综合分析Excel报告

#### 2.1.2 ROI计算与优化
- **功能描述**: 计算每个订单的投资回报率
- **计算公式**: 
  ```
  ROI = 订单金额(RMB) / 欠料金额(RMB)
  特殊情况: 无欠料时标记为"无需投入"
  ```
- **业务价值**: 优先处理高ROI订单，优化现金流

#### 2.1.3 供应商智能选择
- **功能描述**: 为每个物料选择最优供应商
- **选择算法**:
  - 价格因素: 35%权重
  - 时效性: 40%权重（最新修改日期）
  - 稳定性: 25%权重
- **输出**: 主供应商推荐列表

#### 2.1.4 Web仪表板
- **功能描述**: 交互式数据展示和分析界面
- **主要组件**:
  - KPI卡片: 总缺料金额、订单数、供应商数、平均ROI
  - 数据筛选器: 月份、日期范围、ROI阈值、数据完整性
  - 可视化图表: 供应商排名、ROI分布、时间趋势
  - 数据表格: 支持排序、筛选、导出

### 2.2 数据处理需求

#### 2.2.1 数据清洗
- 处理空值和异常值
- 标准化列名映射
- 货币单位转换（USD/HKD/EUR → RMB）
- 数据类型转换（字符串保持、数值规范化）

#### 2.2.2 数据验证
- 订单完整性检查
- 价格合理性验证
- 供应商信息一致性
- 数据质量分层标记

#### 2.2.3 性能要求
- 处理10000+条记录在30秒内完成
- 支持实时数据刷新
- 内存使用优化（避免DataFrame复制）

## 3. 非功能需求

### 3.1 可用性
- 界面直观，无需培训即可使用
- 错误信息友好且可操作
- 支持中文界面和报告

### 3.2 可维护性
- 模块化代码结构
- 完整的日志记录
- 配置与代码分离

### 3.3 兼容性
- 支持Windows/Linux/Mac操作系统
- 兼容Excel 2007+版本
- 支持Chrome/Firefox/Edge浏览器

### 3.4 数据安全
- 本地化部署，数据不外传
- 支持数据备份和恢复
- 审计日志记录

## 4. 系统架构

### 4.1 架构图
```
┌─────────────────────────────────────────────────┐
│                  Web界面层                       │
│         (streamlit_dashboard.py)                │
└─────────────────┬───────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────┐
│                 业务逻辑层                       │
│  ┌──────────────────────────────────────────┐   │
│  │   ComprehensivePMCAnalyzer              │   │
│  │   (silverPlan_analysis.py)              │   │
│  └──────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────┐   │
│  │   辅助分析模块                           │   │
│  │   - 供应商分析                          │   │
│  │   - 订单分析                            │   │
│  │   - 缺料分析                            │   │
│  └──────────────────────────────────────────┘   │
└─────────────────┬───────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────┐
│                  数据访问层                      │
│     Excel文件 → Pandas DataFrame → 分析结果      │
└──────────────────────────────────────────────────┘
```

### 4.2 数据流
```
输入数据 → 数据加载 → 数据清洗 → LEFT JOIN整合 → 
业务计算 → 结果优化 → 报告生成 → Web展示/Excel导出
```

## 5. 接口定义

### 5.1 主要类接口

```python
class ComprehensivePMCAnalyzer:
    """综合PMC分析器"""
    
    def load_all_data(self) -> bool:
        """加载所有数据源"""
        
    def comprehensive_left_join_analysis(self) -> bool:
        """执行LEFT JOIN分析"""
        
    def calculate_derived_fields(self) -> bool:
        """计算派生字段（ROI等）"""
        
    def generate_comprehensive_report(self) -> pd.DataFrame:
        """生成综合报告"""
        
    def save_comprehensive_report(self, report_df: pd.DataFrame) -> str:
        """保存报告到Excel"""
```

### 5.2 数据模型

#### 订单数据模型
```python
{
    "生产单号": str,          # 主键
    "客户订单号": str,
    "产品型号": str,
    "数量Pcs": int,
    "订单金额": float,        # USD
    "客户交期": datetime,
    "月份": str,
    "数据来源工作表": str     # 国内/柬埔寨
}
```

#### 欠料数据模型
```python
{
    "订单编号": str,          # 外键 → 生产单号
    "物料编号": str,
    "物料名称": str,
    "仓存不足": float,        # 欠料数量
    "工单需求": float,
    "已购未返": float,
    "手头现有": float
}
```

## 6. 部署需求

### 6.1 环境要求
- Python 3.10+
- 最小内存: 4GB RAM
- 磁盘空间: 500MB
- 网络: 内网访问

### 6.2 部署方式
- **本地部署**: 直接运行Python脚本
- **Docker部署**: 使用提供的Dockerfile
- **服务器部署**: Streamlit服务器模式

### 6.3 配置管理
- 汇率配置可调整
- 文件路径可配置
- 端口号可自定义

## 7. 测试需求

### 7.1 单元测试
- 数据加载功能测试
- ROI计算准确性测试
- 供应商选择算法测试

### 7.2 集成测试
- 端到端数据流测试
- 多用户并发测试
- 大数据量性能测试

### 7.3 验收标准
- 所有订单100%出现在报告中
- ROI计算准确率>99%
- 页面响应时间<2秒
- 报告生成时间<30秒

## 8. 约束和假设

### 8.1 约束
- 数据文件必须符合预定义格式
- 系统不支持实时数据流
- 单次处理上限10万条记录

### 8.2 假设
- 用户具备基本Excel操作能力
- 数据源定期更新（每日/每周）
- 网络环境稳定

## 9. 风险和缓解措施

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 数据格式变更 | 系统无法解析 | 提供数据格式验证工具 |
| 大数据量性能问题 | 响应缓慢 | 实施分页和缓存机制 |
| 汇率波动 | 计算不准确 | 支持动态汇率配置 |
| 用户操作错误 | 数据错误 | 提供数据回滚功能 |

## 10. 维护和支持

### 10.1 日常维护
- 数据备份: 每日自动备份
- 日志清理: 保留30天日志
- 性能监控: 实时监控关键指标

### 10.2 版本管理
- 使用Git进行版本控制
- 遵循语义化版本号规范
- 维护详细的变更日志

### 10.3 文档要求
- 用户操作手册
- 系统管理员指南
- API接口文档
- 故障排查指南

## 11. 成功标准

- **业务指标**:
  - ROI提升≥20%
  - 缺料率降低≥30%
  - 决策时间缩短80%
  
- **技术指标**:
  - 系统可用性≥99%
  - 数据准确性≥99.5%
  - 用户满意度≥85%

## 12. 项目里程碑

1. **阶段一**: 核心分析引擎开发（已完成）
2. **阶段二**: Web界面开发（已完成）
3. **阶段三**: 系统优化和测试（进行中）
4. **阶段四**: 部署和培训
5. **阶段五**: 运维和持续改进

---

**文档版本**: 1.0.0  
**更新日期**: 2024-08-27  
**作者**: 银图PMC开发团队