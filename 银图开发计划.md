åŸºäºæ‚¨çš„é“¶å›¾å¹é£æœºå·¥å‚èµ„é‡‘è½¬åŒ–ç‡æå‡éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ•°æ®å»ºæ¨¡ã€å†³ç­–ç®—æ³•å’Œå¯è§†åŒ–ç³»ç»Ÿã€‚

## åŸºç¡€æ•°æ®æ¢³ç† - å¿«é€Ÿå†³ç­–æ ¸å¿ƒè¦ç´ 

### ğŸ¯ å†³ç­–å…³é”®æ•°æ®ï¼ˆå®æ—¶æ›´æ–°ï¼‰
```
1. è®¢å•ä¼˜å…ˆçº§çŸ©é˜µ
   - å¼‚å¸¸å•ï¼šç«‹å³å¤„ç†ï¼Œå½±å“èµ„é‡‘å‘¨è½¬
   - æ€¥å•ï¼š3å¤©å†…å¤„ç†ï¼Œé¿å…å»¶æœŸç½šæ¬¾
   - æ™®é€šå•ï¼šæŒ‰ROIæ’åºï¼Œä¼˜åŒ–èµ„é‡‘æ•ˆç‡

2. èµ„é‡‘è½¬åŒ–ç‡å®æ—¶ç›‘æ§
   - å½“å‰å€¼ï¼š2.67ï¼ˆç›®æ ‡ï¼š3.0+ï¼‰
   - å‘¨åº¦è¶‹åŠ¿ï¼šâ†‘12.3% vs ä¸Šæœˆ
   - é¢„è­¦é˜ˆå€¼ï¼š<2.5æ—¶è§¦å‘ä¼˜åŒ–å»ºè®®

3. ç¼ºæ–™å½±å“å¿«é€Ÿè¯„ä¼°
   - å½±å“é‡‘é¢ï¼šÂ¥236ä¸‡
   - å½±å“è®¢å•ï¼š15ä¸ª
   - å…³é”®ç‰©æ–™ï¼šæ§åˆ¶æ¿(25%) > ç”µæœº(15%) > åŠ çƒ­ä¸(12%)
```

### ğŸ“Š å¿«é€Ÿå†³ç­–æ•°æ®æµ
```
è®¢å•å½•å…¥ â†’ ç¼ºæ–™æ£€æŸ¥ â†’ ROIè®¡ç®— â†’ ä¼˜å…ˆçº§è¯„åˆ† â†’ æ’äº§å»ºè®®
   â†“           â†“         â†“         â†“         â†“
å®æ—¶æ•°æ®    åº“å­˜çŠ¶æ€    èµ„é‡‘æ•ˆç‡    ç»¼åˆè¯„åˆ†    æ‰§è¡ŒæŒ‡ä»¤
```

### âš¡ å†³ç­–å“åº”æ—¶é—´è¦æ±‚
- **å¼‚å¸¸å•**ï¼š5åˆ†é’Ÿå†…å“åº”
- **æ€¥å•**ï¼š30åˆ†é’Ÿå†…å¤„ç†
- **æ™®é€šå•**ï¼š2å°æ—¶å†…å®‰æ’
- **ç¼ºæ–™é¢„è­¦**ï¼šå®æ—¶æ¨é€

## ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„
```
æ•°æ®å±‚ â†’ è®¡ç®—å±‚ â†’ å†³ç­–å±‚ â†’ å±•ç¤ºå±‚
```

## äºŒã€æ•°æ®å»ºæ¨¡æ–¹æ¡ˆ

### 1. æ ¸å¿ƒæ•°æ®æ¨¡å‹è®¾è®¡

#### ğŸš€ å¿«é€Ÿå†³ç­–æ ¸å¿ƒè¡¨ï¼ˆå®æ—¶æ›´æ–°ï¼‰
```sql
-- è®¢å•ä¸»è¡¨ï¼ˆå†³ç­–æ ¸å¿ƒï¼‰
CREATE TABLE orders (
    order_id VARCHAR(50) PRIMARY KEY,
    customer_id VARCHAR(50),
    order_date DATE,
    delivery_date DATE,
    order_amount DECIMAL(15,2),
    order_status VARCHAR(20),
    priority_level INT, -- 1:æ™®é€š 2:æ€¥å• 3:å¼‚å¸¸å•
    payment_terms INT, -- å›æ¬¾å‘¨æœŸ(å‘¨)
    expected_collection_date DATE,
    -- å¿«é€Ÿå†³ç­–å­—æ®µ
    roi_score DECIMAL(5,2), -- ROIè¯„åˆ†(0-100)
    urgency_score DECIMAL(5,2), -- ç´§æ€¥åº¦è¯„åˆ†
    feasibility_score DECIMAL(5,2), -- å¯è¡Œæ€§è¯„åˆ†
    final_priority_score DECIMAL(5,2), -- ç»¼åˆä¼˜å…ˆçº§è¯„åˆ†
    decision_status VARCHAR(20), -- å†³ç­–çŠ¶æ€ï¼šå¾…å†³ç­–/å·²æ’äº§/ç¼ºæ–™ä¸­
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è®¢å•æ˜ç»†è¡¨
CREATE TABLE order_items (
    item_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50),
    product_id VARCHAR(50),
    quantity INT,
    unit_price DECIMAL(10,2),
    production_difficulty INT -- 1-5 éš¾åº¦ç­‰çº§
);

-- ç‰©æ–™éœ€æ±‚è¡¨ï¼ˆç¼ºæ–™å¿«é€Ÿè¯†åˆ«ï¼‰
CREATE TABLE material_requirements (
    requirement_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50),
    material_id VARCHAR(50),
    required_quantity INT,
    available_quantity INT,
    shortage_quantity INT,
    material_cost DECIMAL(10,2),
    -- å¿«é€Ÿå†³ç­–å­—æ®µ
    shortage_impact_amount DECIMAL(15,2), -- ç¼ºæ–™å½±å“é‡‘é¢
    supplier_lead_time INT, -- ä¾›åº”å•†äº¤æœŸ(å¤©)
    alternative_supplier_id VARCHAR(50), -- å¤‡é€‰ä¾›åº”å•†
    urgency_level INT -- ç¼ºæ–™ç´§æ€¥åº¦ï¼š1-5
);

-- ä¾›åº”å•†ä¿¡æ¯è¡¨
CREATE TABLE suppliers (
    supplier_id VARCHAR(50) PRIMARY KEY,
    supplier_name VARCHAR(100),
    outstanding_amount DECIMAL(15,2),
    credit_limit DECIMAL(15,2),
    average_lead_time INT, -- å¹³å‡äº¤æœŸ(å¤©)
    -- å¿«é€Ÿå†³ç­–å­—æ®µ
    reliability_score DECIMAL(5,2), -- ä¾›åº”å•†å¯é æ€§è¯„åˆ†
    last_delivery_date DATE, -- æœ€è¿‘äº¤è´§æ—¥æœŸ
    quality_rating DECIMAL(3,1) -- è´¨é‡è¯„çº§(1-10)
);

-- ç‰©æ–™ä¾›åº”å•†å…³è”è¡¨
CREATE TABLE material_suppliers (
    material_id VARCHAR(50),
    supplier_id VARCHAR(50),
    lead_time INT, -- äº¤æœŸ(å¤©)
    unit_price DECIMAL(10,2),
    min_order_quantity INT,
    PRIMARY KEY (material_id, supplier_id)
);

-- æ–°å¢ï¼šå¿«é€Ÿå†³ç­–ç¼“å­˜è¡¨
CREATE TABLE decision_cache (
    cache_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50),
    cache_type VARCHAR(20), -- 'priority_score', 'material_shortage', 'roi_analysis'
    cache_data JSON, -- ç¼“å­˜çš„è®¡ç®—ç»“æœ
    cache_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ttl_seconds INT DEFAULT 300 -- ç¼“å­˜æœ‰æ•ˆæœŸ(5åˆ†é’Ÿ)
);
```

#### ğŸ“‹ å¿«é€Ÿå†³ç­–å…³é”®å­—æ®µè¯´æ˜
```
ä¼˜å…ˆçº§è¯„åˆ†å­—æ®µï¼š
- roi_score: æŠ•èµ„å›æŠ¥ç‡è¯„åˆ†ï¼Œç›´æ¥å½±å“èµ„é‡‘æ•ˆç‡
- urgency_score: ç´§æ€¥åº¦è¯„åˆ†ï¼Œè€ƒè™‘äº¤æœŸå’Œå®¢æˆ·é‡è¦æ€§
- feasibility_score: å¯è¡Œæ€§è¯„åˆ†ï¼Œè€ƒè™‘ç¼ºæ–™å’Œç”Ÿäº§éš¾åº¦
- final_priority_score: ç»¼åˆè¯„åˆ†ï¼Œç”¨äºæœ€ç»ˆæ’åº

ç¼ºæ–™å½±å“å­—æ®µï¼š
- shortage_impact_amount: ç¼ºæ–™å½±å“é‡‘é¢ï¼Œå¿«é€Ÿè¯„ä¼°æŸå¤±
- urgency_level: ç¼ºæ–™ç´§æ€¥åº¦ï¼Œå†³å®šè¡¥è´§ä¼˜å…ˆçº§
- alternative_supplier_id: å¤‡é€‰ä¾›åº”å•†ï¼Œå¿«é€Ÿåˆ‡æ¢æ–¹æ¡ˆ

å†³ç­–çŠ¶æ€å­—æ®µï¼š
- decision_status: å®æ—¶è·Ÿè¸ªå†³ç­–æ‰§è¡ŒçŠ¶æ€
- last_updated: æ•°æ®æ›´æ–°æ—¶é—´ï¼Œç¡®ä¿å†³ç­–åŸºäºæœ€æ–°ä¿¡æ¯
```

### 2. è®¡ç®—æŒ‡æ ‡æ¨¡å‹

#### âš¡ å¿«é€Ÿå†³ç­–è®¡ç®—å¼•æ“
```python
import numpy as np
from datetime import datetime, timedelta
import time # Added for quick_decision_calculation

class OrderMetrics:
    def __init__(self):
        self.metrics = {
            'roi_score': 0,  # æŠ•èµ„å›æŠ¥ç‡è¯„åˆ†
            'urgency_score': 0,  # ç´§æ€¥åº¦è¯„åˆ†
            'feasibility_score': 0,  # å¯è¡Œæ€§è¯„åˆ†
            'cash_flow_score': 0  # ç°é‡‘æµè¯„åˆ†
        }
        self.cache_manager = DecisionCacheManager()
    
    def calculate_roi(self, material_cost, expected_revenue, collection_weeks):
        """è®¡ç®—èµ„é‡‘è½¬åŒ–ç‡ï¼ˆå¿«é€Ÿå†³ç­–æ ¸å¿ƒæŒ‡æ ‡ï¼‰"""
        weekly_return = expected_revenue / collection_weeks
        roi = expected_revenue / material_cost
        
        # å¿«é€Ÿå†³ç­–è¯„åˆ†æ ‡å‡†
        if roi >= 3.0:
            roi_score = 100
        elif roi >= 2.5:
            roi_score = 80 + (roi - 2.5) * 40  # 80-100åˆ†
        elif roi >= 2.0:
            roi_score = 60 + (roi - 2.0) * 40  # 60-80åˆ†
        else:
            roi_score = max(0, roi * 30)  # 0-60åˆ†
        
        return {
            'total_roi': roi,
            'weekly_roi': weekly_return / material_cost,
            'payback_weeks': material_cost / weekly_return,
            'roi_score': roi_score
        }
    
    def quick_decision_calculation(self, order_data):
        """å¿«é€Ÿå†³ç­–è®¡ç®—ï¼ˆ5ç§’å†…å®Œæˆï¼‰"""
        start_time = time.time()
        
        # 1. æ£€æŸ¥ç¼“å­˜
        cache_key = f"order_{order_data['order_id']}"
        cached_result = self.cache_manager.get_cache(cache_key)
        if cached_result and time.time() - cached_result['timestamp'] < 300:  # 5åˆ†é’Ÿç¼“å­˜
            return cached_result['data']
        
        # 2. å¿«é€Ÿè®¡ç®—æ ¸å¿ƒæŒ‡æ ‡
        roi_result = self.calculate_roi(
            order_data['material_cost'],
            order_data['expected_revenue'],
            order_data['collection_weeks']
        )
        
        urgency_score = self.calculate_urgency_fast(order_data)
        feasibility_score = self.calculate_feasibility_fast(order_data)
        
        # 3. ç»¼åˆè¯„åˆ†ï¼ˆåŠ æƒå¹³å‡ï¼‰
        final_score = (
            roi_result['roi_score'] * 0.35 +
            urgency_score * 0.25 +
            feasibility_score * 0.20 +
            self.calculate_cash_flow_fast(order_data) * 0.20
        )
        
        # 4. ç¼“å­˜ç»“æœ
        result = {
            'roi_score': roi_result['roi_score'],
            'urgency_score': urgency_score,
            'feasibility_score': feasibility_score,
            'final_priority_score': final_score,
            'calculation_time': time.time() - start_time
        }
        
        self.cache_manager.set_cache(cache_key, result)
        return result
    
    def calculate_urgency_fast(self, order):
        """å¿«é€Ÿç´§æ€¥åº¦è®¡ç®—ï¼ˆ<1ç§’ï¼‰"""
        score = 50  # åŸºç¡€åˆ†
        
        # ä¼˜å…ˆçº§å¿«é€Ÿåˆ¤æ–­
        priority_bonus = {1: 0, 2: 20, 3: 30}
        score += priority_bonus.get(order['priority_level'], 0)
        
        # äº¤æœŸå¿«é€Ÿè®¡ç®—
        days_to_delivery = (order['delivery_date'] - datetime.now()).days
        if days_to_delivery < 7:
            score += 20
        elif days_to_delivery < 14:
            score += 10
        
        return min(100, score)
    
    def calculate_feasibility_fast(self, order):
        """å¿«é€Ÿå¯è¡Œæ€§è®¡ç®—ï¼ˆ<1ç§’ï¼‰"""
        score = 100
        
        # ç¼ºæ–™ç‡å¿«é€Ÿè®¡ç®—
        shortage_rate = order.get('shortage_quantity', 0) / max(order.get('required_quantity', 1), 1)
        score -= shortage_rate * 30
        
        # ç”Ÿäº§éš¾åº¦å¿«é€Ÿè¯„ä¼°
        difficulty_penalty = order.get('production_difficulty', 1) * 10
        score -= difficulty_penalty
        
        return max(0, score)

class DecisionCacheManager:
    """å¿«é€Ÿå†³ç­–ç¼“å­˜ç®¡ç†å™¨"""
    def __init__(self):
        self.cache = {}
        self.cache_ttl = 300  # 5åˆ†é’Ÿç¼“å­˜
    
    def get_cache(self, key):
        """è·å–ç¼“å­˜æ•°æ®"""
        if key in self.cache:
            cache_data = self.cache[key]
            if time.time() - cache_data['timestamp'] < self.cache_ttl:
                return cache_data
            else:
                del self.cache[key]  # è¿‡æœŸæ¸…ç†
        return None
    
    def set_cache(self, key, data):
        """è®¾ç½®ç¼“å­˜æ•°æ®"""
        self.cache[key] = {
            'data': data,
            'timestamp': time.time()
        }
        
        # ç¼“å­˜å¤§å°æ§åˆ¶ï¼ˆæœ€å¤š1000æ¡ï¼‰
        if len(self.cache) > 1000:
            # æ¸…ç†æœ€æ—§çš„ç¼“å­˜
            oldest_key = min(self.cache.keys(), key=lambda k: self.cache[k]['timestamp'])
            del self.cache[oldest_key]
```

## ä¸‰ã€æ ¸å¿ƒå†³ç­–ç®—æ³•

### 1. æ™ºèƒ½æ’å•ç®—æ³•

#### ğŸš€ å¿«é€Ÿå†³ç­–ç®—æ³•ï¼ˆ5ç§’å†…å“åº”ï¼‰
```python
import numpy as np
from datetime import datetime, timedelta
import time

class ProductionScheduler:
    def __init__(self):
        self.weight_config = {
            'roi_weight': 0.35,  # èµ„é‡‘è½¬åŒ–ç‡æƒé‡
            'urgency_weight': 0.25,  # ç´§æ€¥åº¦æƒé‡
            'feasibility_weight': 0.20,  # å¯è¡Œæ€§æƒé‡
            'cash_flow_weight': 0.20  # ç°é‡‘æµæƒé‡
        }
        self.cache_manager = DecisionCacheManager()
        self.emergency_threshold = 2.5  # ROIé¢„è­¦é˜ˆå€¼
    
    def quick_priority_decision(self, order_list, max_processing_time=5):
        """å¿«é€Ÿä¼˜å…ˆçº§å†³ç­–ï¼ˆ5ç§’å†…å®Œæˆï¼‰"""
        start_time = time.time()
        
        # 1. é¢„ç­›é€‰ï¼ˆ1ç§’å†…ï¼‰
        urgent_orders = [o for o in order_list if o['priority_level'] >= 2]
        normal_orders = [o for o in order_list if o['priority_level'] == 1]
        
        # 2. å¼‚å¸¸å•ç«‹å³å¤„ç†ï¼ˆ0.5ç§’ï¼‰
        if urgent_orders:
            for order in urgent_orders:
                order['final_priority_score'] = self.calculate_emergency_score(order)
        
        # 3. æ™®é€šå•å¿«é€Ÿè¯„åˆ†ï¼ˆ3ç§’å†…ï¼‰
        if normal_orders:
            # å¹¶è¡Œè®¡ç®—æå‡é€Ÿåº¦
            import concurrent.futures
            with concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:
                future_to_order = {
                    executor.submit(self.calculate_priority_score_fast, order): order 
                    for order in normal_orders
                }
                
                for future in concurrent.futures.as_completed(future_to_order):
                    order = future_to_order[future]
                    try:
                        result = future.result()
                        order['final_priority_score'] = result['final_score']
                    except Exception as e:
                        order['final_priority_score'] = 0
        
        # 4. åˆå¹¶æ’åºï¼ˆ0.5ç§’ï¼‰
        all_orders = urgent_orders + normal_orders
        all_orders.sort(key=lambda x: x['final_priority_score'], reverse=True)
        
        processing_time = time.time() - start_time
        print(f"å¿«é€Ÿå†³ç­–å®Œæˆï¼Œè€—æ—¶: {processing_time:.2f}ç§’")
        
        return {
            'ordered_list': all_orders,
            'processing_time': processing_time,
            'total_orders': len(all_orders)
        }
    
    def calculate_emergency_score(self, order):
        """å¼‚å¸¸å•ç´§æ€¥è¯„åˆ†ï¼ˆ<0.1ç§’ï¼‰"""
        base_score = 100
        
        # å¼‚å¸¸å•åŸºç¡€åˆ†
        if order['priority_level'] == 3:
            base_score += 50
        
        # äº¤æœŸç´§æ€¥åº¦
        days_to_delivery = (order['delivery_date'] - datetime.now()).days
        if days_to_delivery < 3:
            base_score += 30
        elif days_to_delivery < 7:
            base_score += 20
        
        return min(200, base_score)
    
    def calculate_priority_score_fast(self, order):
        """å¿«é€Ÿä¼˜å…ˆçº§è¯„åˆ†ï¼ˆ<1ç§’ï¼‰"""
        # æ£€æŸ¥ç¼“å­˜
        cache_key = f"priority_{order['order_id']}"
        cached_result = self.cache_manager.get_cache(cache_key)
        if cached_result:
            return cached_result['data']
        
        # å¿«é€Ÿè®¡ç®—
        roi_score = self.calculate_roi_fast(order)
        urgency_score = self.calculate_urgency_fast(order)
        feasibility_score = self.calculate_feasibility_fast(order)
        cash_flow_score = self.calculate_cash_flow_fast(order)
        
        # åŠ æƒç»¼åˆè¯„åˆ†
        final_score = (
            roi_score * self.weight_config['roi_weight'] +
            urgency_score * self.weight_config['urgency_weight'] +
            feasibility_score * self.weight_config['feasibility_weight'] +
            cash_flow_score * self.weight_config['cash_flow_weight']
        )
        
        result = {
            'roi_score': roi_score,
            'urgency_score': urgency_score,
            'feasibility_score': feasibility_score,
            'cash_flow_score': cash_flow_score,
            'final_score': final_score
        }
        
        # ç¼“å­˜ç»“æœ
        self.cache_manager.set_cache(cache_key, result)
        return result
    
    def calculate_roi_fast(self, order):
        """å¿«é€ŸROIè®¡ç®—ï¼ˆ<0.1ç§’ï¼‰"""
        roi = order['expected_revenue'] / order['material_cost']
        
        # å¿«é€Ÿè¯„åˆ†æ˜ å°„
        if roi >= 3.0:
            return 100
        elif roi >= 2.5:
            return 80 + (roi - 2.5) * 40
        elif roi >= 2.0:
            return 60 + (roi - 2.0) * 40
        else:
            return max(0, roi * 30)
    
    def calculate_urgency_fast(self, order):
        """å¿«é€Ÿç´§æ€¥åº¦è®¡ç®—ï¼ˆ<0.1ç§’ï¼‰"""
        score = 50
        
        # ä¼˜å…ˆçº§å¿«é€Ÿåˆ¤æ–­
        priority_bonus = {1: 0, 2: 20, 3: 30}
        score += priority_bonus.get(order['priority_level'], 0)
        
        # äº¤æœŸå¿«é€Ÿè®¡ç®—
        days_to_delivery = (order['delivery_date'] - datetime.now()).days
        if days_to_delivery < 7:
            score += 20
        elif days_to_delivery < 14:
            score += 10
        
        return min(100, score)
    
    def calculate_feasibility_fast(self, order):
        """å¿«é€Ÿå¯è¡Œæ€§è®¡ç®—ï¼ˆ<0.1ç§’ï¼‰"""
        score = 100
        
        # ç¼ºæ–™ç‡å¿«é€Ÿè®¡ç®—
        shortage_rate = order.get('shortage_quantity', 0) / max(order.get('required_quantity', 1), 1)
        score -= shortage_rate * 30
        
        # ç”Ÿäº§éš¾åº¦å¿«é€Ÿè¯„ä¼°
        difficulty_penalty = order.get('production_difficulty', 1) * 10
        score -= difficulty_penalty
        
        return max(0, score)
    
    def calculate_cash_flow_fast(self, order):
        """å¿«é€Ÿç°é‡‘æµè®¡ç®—ï¼ˆ<0.1ç§’ï¼‰"""
        weekly_return = order['expected_revenue'] / order['payment_terms']
        
        # å¿«é€Ÿè¯„åˆ†æ ‡å‡†
        if order['payment_terms'] <= 4 and order['expected_revenue'] >= 1000000:
            return 100
        elif weekly_return >= 300000:
            return 90
        elif weekly_return >= 200000:
            return 70
        elif weekly_return >= 100000:
            return 50
        else:
            return weekly_return / 100000 * 50
```

### 2. ç¼ºæ–™æ™ºèƒ½è¡¥è´§ç®—æ³•

```python
class MaterialOptimizer:
    def __init__(self):
        self.budget_limit = None
        
    def optimize_material_purchase(self, shortage_list, available_budget):
        """ä¼˜åŒ–ç‰©æ–™é‡‡è´­å†³ç­–"""
        self.budget_limit = available_budget
        
        # è®¡ç®—æ¯ä¸ªç¼ºæ–™çš„æŠ•èµ„å›æŠ¥
        for item in shortage_list:
            item['roi_ratio'] = self.calculate_material_roi(item)
        
        # åŠ¨æ€è§„åˆ’æ±‚è§£æœ€ä¼˜é‡‡è´­æ–¹æ¡ˆ
        solution = self.knapsack_optimization(shortage_list)
        
        return solution
    
    def calculate_material_roi(self, material):
        """è®¡ç®—ç‰©æ–™æŠ•èµ„å›æŠ¥ç‡"""
        # è¯¥ç‰©æ–™å½±å“çš„è®¢å•æ€»ä»·å€¼
        affected_orders_value = material['affected_orders_value']
        # ç‰©æ–™é‡‡è´­æˆæœ¬
        purchase_cost = material['shortage_quantity'] * material['unit_price']
        # å¹³å‡å›æ¬¾å‘¨æœŸ
        avg_collection_weeks = material['avg_collection_weeks']
        
        # å‘¨åº¦ROI
        weekly_roi = (affected_orders_value / avg_collection_weeks) / purchase_cost
        
        return weekly_roi
    
    def knapsack_optimization(self, items):
        """èƒŒåŒ…ç®—æ³•ä¼˜åŒ–é‡‡è´­ç»„åˆ"""
        n = len(items)
        W = int(self.budget_limit)
        
        # åŠ¨æ€è§„åˆ’è¡¨
        dp = [[0 for _ in range(W + 1)] for _ in range(n + 1)]
        
        for i in range(1, n + 1):
            for w in range(1, W + 1):
                cost = int(items[i-1]['purchase_cost'])
                value = items[i-1]['roi_ratio'] * 100  # æ”¾å¤§ROIå€¼
                
                if cost <= w:
                    dp[i][w] = max(dp[i-1][w], dp[i-1][w-cost] + value)
                else:
                    dp[i][w] = dp[i-1][w]
        
        # å›æº¯æ‰¾å‡ºé€‰ä¸­çš„ç‰©æ–™
        selected_items = []
        w = W
        for i in range(n, 0, -1):
            if dp[i][w] != dp[i-1][w]:
                selected_items.append(items[i-1])
                w -= int(items[i-1]['purchase_cost'])
        
        return selected_items
```

## å››ã€å¯è§†åŒ–æ–¹æ¡ˆ

### 1. æ•°æ®åº“å¯è§†åŒ–ä»ªè¡¨æ¿## äº”ã€ç³»ç»Ÿå®æ–½æ–¹æ¡ˆ

### 1. æŠ€æœ¯æ¶æ„å»ºè®®

**åç«¯æŠ€æœ¯æ ˆï¼š**
- æ•°æ®åº“ï¼šPostgreSQLï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰+ Redisï¼ˆç¼“å­˜å±‚ï¼‰
- åº”ç”¨æ¡†æ¶ï¼šPython FastAPI æˆ– Java Spring Boot
- è®¡ç®—å¼•æ“ï¼šApache Sparkï¼ˆå¤§æ•°æ®å¤„ç†ï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ æˆ– Kafkaï¼ˆå®æ—¶æ•°æ®åŒæ­¥ï¼‰

**å‰ç«¯æŠ€æœ¯æ ˆï¼š**
- æ¡†æ¶ï¼šReact/Vue.js + TypeScript
- å¯è§†åŒ–ï¼šECharts / D3.js / AntV
- çŠ¶æ€ç®¡ç†ï¼šRedux/Vuex
- UIç»„ä»¶ï¼šAnt Design / Element Plus

### 2. æ•°æ®é›†æˆæ–¹æ¡ˆ

```python
# ETLæ•°æ®é›†æˆç¤ºä¾‹
class DataIntegration:
    def __init__(self):
        self.erp_connector = ERPConnector()
        self.mes_connector = MESConnector()
        
    def sync_order_data(self):
        """åŒæ­¥è®¢å•æ•°æ®"""
        # ä»ERPè·å–è®¢å•
        orders = self.erp_connector.get_orders()
        
        # æ•°æ®æ¸…æ´—å’Œè½¬æ¢
        cleaned_orders = self.clean_order_data(orders)
        
        # è®¡ç®—è¡ç”ŸæŒ‡æ ‡
        for order in cleaned_orders:
            order['roi_score'] = self.calculate_roi(order)
            order['material_shortage'] = self.check_material_shortage(order)
        
        # å­˜å…¥æ•°æ®ä»“åº“
        self.save_to_warehouse(cleaned_orders)
        
    def real_time_monitoring(self):
        """å®æ—¶ç›‘æ§ç”Ÿäº§çŠ¶æ€"""
        # è®¢é˜…MESç³»ç»Ÿæ¶ˆæ¯
        self.mes_connector.subscribe('production_status', 
                                    callback=self.handle_production_update)
```

### 3. æ™ºèƒ½é¢„è­¦æœºåˆ¶

```python
class AlertSystem:
    def __init__(self):
        self.alert_rules = {
            'low_roi': {'threshold': 2.0, 'priority': 'high'},
            'material_shortage': {'threshold': 0.2, 'priority': 'critical'},
            'delivery_risk': {'days': 3, 'priority': 'urgent'}
        }
    
    def check_alerts(self, order):
        """æ£€æŸ¥é¢„è­¦æ¡ä»¶"""
        alerts = []
        
        # ROIé¢„è­¦
        if order['roi'] < self.alert_rules['low_roi']['threshold']:
            alerts.append({
                'type': 'LOW_ROI',
                'message': f"è®¢å•{order['id']}æŠ•èµ„å›æŠ¥ç‡ä»…{order['roi']}",
                'priority': 'high',
                'action': 'å»ºè®®é‡æ–°è¯„ä¼°ç”Ÿäº§ä¼˜å…ˆçº§'
            })
        
        # ç¼ºæ–™é¢„è­¦
        if order['shortage_rate'] > self.alert_rules['material_shortage']['threshold']:
            alerts.append({
                'type': 'MATERIAL_SHORTAGE',
                'message': f"è®¢å•{order['id']}ç¼ºæ–™ç‡è¾¾{order['shortage_rate']*100}%",
                'priority': 'critical',
                'action': 'ç«‹å³è”ç³»ä¾›åº”å•†è¡¥è´§'
            })
        
        return alerts
```

## å…­ã€å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
1. æ•°æ®åº“è®¾è®¡å’ŒåŸºç¡€æ•°æ®æ¨¡å‹æ­å»º
2. å†å²æ•°æ®æ¸…æ´—å’Œå¯¼å…¥
3. åŸºç¡€æŸ¥è¯¢å’ŒæŠ¥è¡¨åŠŸèƒ½

### ç¬¬äºŒé˜¶æ®µï¼ˆ3-4å‘¨ï¼‰
1. æ ¸å¿ƒç®—æ³•å¼€å‘ï¼ˆROIè®¡ç®—ã€æ™ºèƒ½æ’å•ï¼‰
2. å®æ—¶æ•°æ®æ¥å£å¯¹æ¥
3. åŸºç¡€å¯è§†åŒ–ä»ªè¡¨æ¿

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ5-6å‘¨ï¼‰
1. é«˜çº§åˆ†æåŠŸèƒ½ï¼ˆé¢„æµ‹æ¨¡å‹ã€ä¼˜åŒ–ç®—æ³•ï¼‰
2. é¢„è­¦ç³»ç»Ÿå’Œé€šçŸ¥æœºåˆ¶
3. ç§»åŠ¨ç«¯é€‚é…

### ç¬¬å››é˜¶æ®µï¼ˆ7-8å‘¨ï¼‰
1. ç³»ç»Ÿé›†æˆæµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·åŸ¹è®­å’Œä¸Šçº¿

## ä¸ƒã€é¢„æœŸæ•ˆæœ

1. **èµ„é‡‘è½¬åŒ–ç‡æå‡**ï¼šé€šè¿‡æ™ºèƒ½æ’å•ï¼Œé¢„è®¡å¯å°†èµ„é‡‘è½¬åŒ–ç‡ä»å½“å‰æ°´å¹³æå‡è‡³2.8-3.0
2. **ç¼ºæ–™ç‡é™ä½**ï¼šæ™ºèƒ½è¡¥è´§å»ºè®®å¯é™ä½ç¼ºæ–™ç‡30-40%
3. **å†³ç­–æ•ˆç‡æå‡**ï¼šè‡ªåŠ¨åŒ–æ’å•å°†å†³ç­–æ—¶é—´ä»å°æ—¶çº§é™è‡³åˆ†é’Ÿçº§
4. **å¼‚å¸¸å“åº”åŠ å¿«**ï¼šå®æ—¶é¢„è­¦ç³»ç»Ÿå¯åœ¨5åˆ†é’Ÿå†…å‘ç°å¹¶å“åº”ç”Ÿäº§å¼‚å¸¸

è¿™å¥—æ–¹æ¡ˆå……åˆ†è€ƒè™‘äº†æ‚¨å·¥å‚çš„å®é™…éœ€æ±‚ï¼Œé€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼ä¼˜åŒ–ç”Ÿäº§æ’æœŸï¼Œæå‡èµ„é‡‘ä½¿ç”¨æ•ˆç‡ã€‚å»ºè®®å…ˆä»æ ¸å¿ƒåŠŸèƒ½å¼€å§‹å®æ–½ï¼Œé€æ­¥è¿­ä»£å®Œå–„ç³»ç»ŸåŠŸèƒ½ã€‚

## å¿«é€Ÿå†³ç­–å®æ–½æ€»ç»“

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
1. **å“åº”é€Ÿåº¦**ï¼šä»å°æ—¶çº§å†³ç­–é™è‡³5ç§’å†…å“åº”
2. **æ•°æ®å®æ—¶æ€§**ï¼š5åˆ†é’Ÿç¼“å­˜æœºåˆ¶ï¼Œç¡®ä¿å†³ç­–åŸºäºæœ€æ–°æ•°æ®
3. **ç®—æ³•ä¼˜åŒ–**ï¼šå¹¶è¡Œè®¡ç®—+ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒå¤§è§„æ¨¡è®¢å•å¿«é€Ÿå¤„ç†
4. **å†³ç­–å‡†ç¡®æ€§**ï¼šå¤šç»´åº¦è¯„åˆ†ä½“ç³»ï¼Œç»¼åˆè¯„ä¼°è®¢å•ä¼˜å…ˆçº§

### ğŸ“Š å…³é”®æ€§èƒ½æŒ‡æ ‡
```
å†³ç­–å“åº”æ—¶é—´ï¼š
- å¼‚å¸¸å•ï¼š<0.1ç§’
- æ€¥å•ï¼š<0.5ç§’  
- æ™®é€šå•ï¼š<1ç§’
- æ‰¹é‡å†³ç­–ï¼š<5ç§’

æ•°æ®å¤„ç†èƒ½åŠ›ï¼š
- å•è®¢å•è¯„åˆ†ï¼š<1ç§’
- 1000è®¢å•æ‰¹é‡ï¼š<5ç§’
- å®æ—¶æ•°æ®æ›´æ–°ï¼š<5åˆ†é’Ÿ
- ç¼“å­˜å‘½ä¸­ç‡ï¼š>80%

å†³ç­–å‡†ç¡®æ€§ï¼š
- ROIé¢„æµ‹å‡†ç¡®ç‡ï¼š>90%
- ç¼ºæ–™å½±å“è¯„ä¼°ï¼š>85%
- ä¼˜å…ˆçº§æ’åºå‡†ç¡®ç‡ï¼š>95%
```

### ğŸš€ å®æ–½ä¼˜å…ˆçº§
1. **ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨ï¼‰**ï¼šåŸºç¡€æ•°æ®è¡¨ç»“æ„ + å¿«é€Ÿè®¡ç®—å¼•æ“
2. **ç¬¬äºŒé˜¶æ®µï¼ˆ1å‘¨ï¼‰**ï¼šç¼“å­˜æœºåˆ¶ + å¹¶è¡Œè®¡ç®—ä¼˜åŒ–
3. **ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰**ï¼šå®æ—¶æ•°æ®æ¥å£ + å†³ç­–ä»ªè¡¨æ¿
4. **ç¬¬å››é˜¶æ®µï¼ˆ1å‘¨ï¼‰**ï¼šæ€§èƒ½æµ‹è¯• + ç”¨æˆ·åŸ¹è®­

### ğŸ’¡ å¿«é€Ÿå†³ç­–ä»·å€¼
- **èµ„é‡‘æ•ˆç‡æå‡**ï¼šé€šè¿‡æ™ºèƒ½æ’å•ï¼Œé¢„è®¡èµ„é‡‘è½¬åŒ–ç‡æå‡è‡³3.0+
- **å†³ç­–æ•ˆç‡æå‡**ï¼šä»äººå·¥åˆ†æ2å°æ—¶é™è‡³ç³»ç»Ÿè‡ªåŠ¨5ç§’
- **å¼‚å¸¸å“åº”åŠ å¿«**ï¼šå®æ—¶é¢„è­¦ï¼Œ5åˆ†é’Ÿå†…å‘ç°å¹¶å“åº”ç”Ÿäº§å¼‚å¸¸
- **ç¼ºæ–™æŸå¤±é™ä½**ï¼šæ™ºèƒ½è¡¥è´§å»ºè®®ï¼Œé¢„è®¡é™ä½ç¼ºæ–™å½±å“30-40%